local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local VirtualInputManager = game:GetService("VirtualInputManager")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")

 local Part = Instance.new("Part", Workspace)
 Part.Name = "TeleportS"
 Part.CFrame = Workspace["Shaggy 1%"]:GetModelCFrame()
Part.Anchored = true
Part.Transparency = 1
 Part.CanCollide = false

local function resetCharacter()
    player:LoadCharacter()
end

local function detectBoss()
    return Workspace:FindFirstChild("Shaggy 1%")
end

local function transformAndTeleport()

    local args = {
        [1] = "galactic saiyan"
    }
    ReplicatedStorage:WaitForChild("Transform"):FireServer(unpack(args))
    wait(10)
    VirtualInputManager:SendKeyEvent(true, "X", false, game)
    wait(10)
    VirtualInputManager:SendKeyEvent(false, "X", false, game)
    player.Character.HumanoidRootPart.CFrame = CFrame.new(Part.Position - Part.CFrame.LookVector * 1, Part.Position)
end

local function mainLoop()
    while wait() do
        local boss = detectBoss()
        if not boss then
            resetCharacter()
            repeat
                wait(1)
                boss = detectBoss()
            until boss
            transformAndTeleport()
        end

        if not player.Character:FindFirstChild("Humanoid") or player.Character.Humanoid.Health <= 0 then
            break
        end

        player.Character.HumanoidRootPart.CFrame = CFrame.new(boss.HumanoidRootPart.Position - boss.HumanoidRootPart.CFrame.LookVector * 1, boss.HumanoidRootPart.Position)
        VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 0)

        local args = {
            [1] = false,
            [2] = boss.HumanoidRootPart.Position
        }
        ReplicatedStorage.Events:FindFirstChild("Infinite Barrage Fists"):FireServer(unpack(args))
    end
end

player.CharacterAdded:Connect(function()
    local boss = detectBoss()
    if not boss then
        resetCharacter()
        repeat
            wait(1)
            boss = detectBoss()
        until boss
    end

    transformAndTeleport()

    mainLoop()
end)
