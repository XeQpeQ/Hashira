local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local VirtualInputManager = game:GetService("VirtualInputManager")
local gui, mainFrame, originalSize, isExpanded
local energy = workspace[player.Name].State.Energy.Value
local maxEnergy = workspace[player.Name].State.MaxEnergy.Value

-- Function to toggle GUI visibility
local function toggleGUIVisibility(visible)
    if gui then
        gui.Enabled = visible
    end
end

-- Function to toggle GUI size
local function toggleGUISize(expand)
    if mainFrame and originalSize then
        if expand then
            mainFrame.Size = originalSize
        else
            mainFrame.Size = UDim2.new(0, 150, 0, 100) -- Modify the size as needed
        end
        isExpanded = expand
    end
end

local bb = game:GetService('VirtualUser')

game:GetService('Players').LocalPlayer.Idled:Connect(function()
    bb:CaptureController()
    bb:ClickButton2(Vector2.new())
    
    -- Verifica si 'ab' está definida antes de cambiar su texto
    if ab then
        ab.Text = "Roblox intentó expulsarte, pero lo evité"
        wait(2)
        ab.Text = "Estado: Activo"
    end
end)

local HashiraUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/XeQpeQ/Hashira/main/UI2.lua"))()
local win = HashiraUI:Create({
    Name = "Hashira Hub",
    StartupSound = {
        Toggle = false,
        SoundID = "rbxassetid://6958727243",
        TimePosition = 1
    }
})
local maintab = win:Tab('Main')
local AutoFarm = win:Tab('AutoFarm')
local uitab = win:Tab('UI')

uitab:Button('Destroy GUI', function()
    win:Exit()
end)

local Quest = {
    "Top X Fighter",
    "SSJB Wukong",
    "Citizen",
    "Kid Nohag",
    "Chilly",
    "X Fighter Trainer",
    "Super Vegetable",
    "Klirin",
    "SSJ2 Wukong",
    "Perfect Atom",
    "Radish",
    "Mapa",
    "Broccoli",
    "SSJG Kakata",
    "Kai-fist Master",
    "Kaio Student",
    "Turtle Student"
}

local function quest()
    if game:GetService("ReplicatedStorage").Datas[player.UserId].Quest.Value ~= "Top X Fighter" then
        player.Character.HumanoidRootPart.CFrame = game:GetService("Workspace").Others.NPCs["Top X Fighter"].HumanoidRootPart.CFrame
        repeat
            wait()
            events.Qaction:InvokeServer(game:GetService("Workspace").Others.NPCs["Top X Fighter"])
        until game:GetService("ReplicatedStorage").Datas[player.UserId].Quest.Value == "Top X Fighter"
    end
end

maintab:Toggle('Auto Train E', function(v)
    getgenv().AutoAttack = v
end)

maintab:Toggle('Auto Train Q', function(v)
    getgenv().AutoEnergy = v
end)

AutoFarm:Toggle('Auto X Fighter', function(v)
    getgenv().Autoxfighter = v
end)

local Stepped
Stepped = game:GetService('RunService').Stepped:Connect(function()
    if player.Character and player.Character:FindFirstChild("Humanoid") then 
        player.Character.Humanoid:ChangeState(11)
    end
    if getgenv().Autoxfighter == false then 
        Stepped:Disconnect()
    end
end)

task.spawn(function()
    while task.wait() do
        pcall(function()
            if getgenv().Autoxfighter and game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
                for i, v in ipairs(game:GetService("Workspace").Living:GetChildren()) do
                    if v.Name:match("X Fighter") and player.Character and player.Character:FindFirstChild("HumanoidRootPart") and v:FindFirstChild("Humanoid") and v:FindFirstChild("HumanoidRootPart") and v.Humanoid.Health > 0 then
                        repeat
                            quest()
                            player.Character.HumanoidRootPart.CFrame = v.HumanoidRootPart.CFrame + v.HumanoidRootPart.CFrame.lookVector * 7
                            wait()
                            local ohString1 = "Blacknwhite27"
                            local ohNumber2 = 1
                            game:GetService("ReplicatedStorage").Package.Events.p:FireServer(ohString1, ohNumber2)
                        until getgenv().Autoxfighter == false or v == nil or v.Humanoid.Health <= 0
                    end
                end
            end
        end)
    end
end)

task.spawn(function()
    while task.wait() do
        pcall(function()
            if getgenv().AutoAttack then
                VirtualInputManager:SendKeyEvent(true,"E",false,game) 
            end
        end)
    end
end)

task.spawn(function()
    local autoC = false
    
    while wait() do
        pcall(function()
            local energy = workspace[player.Name].State.Energy.Value
            local maxEnergy = workspace[player.Name].State.MaxEnergy.Value
            
            if getgenv().AutoEnergy then
                if energy <= 50 then
                    VirtualInputManager:SendKeyEvent(true, "C", false, game)
                    autoC = true
                elseif energy >= maxEnergy then
                    VirtualInputManager:SendKeyEvent(false, "C", false, game)
                    autoC = false
                end
                
                if not autoC then
                    VirtualInputManager:SendKeyEvent(true, "Q", false, game)
                else
                    VirtualInputManager:SendKeyEvent(false, "Q", false, game)
                end
            else
                VirtualInputManager:SendKeyEvent(false, "C", false, game)
                VirtualInputManager:SendKeyEvent(false, "Q", false, game)
            end
        end)
    end
end)
